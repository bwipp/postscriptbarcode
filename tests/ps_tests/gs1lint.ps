%!PS

/gs1lint dup /uk.co.terryburton.bwipp findresource cvx def

/parse {
    /barcode exch def
    /ais  [] def
    /vals [] def
    barcode dup length 1 sub 1 exch getinterval
    {  % loop
        dup () eq {exit} if
        (\)) search pop
        exch pop
        exch (\() search {
            exch pop exch 3 1 roll
        } {
            () 3 1 roll
        } ifelse
        [ ais  aload pop counttomark 2 add index ] /ais exch def
        [ vals aload pop counttomark 1 add index ] /vals exch def
        pop pop
    } loop
    pop
    ais vals
} bind def

/good_tmpl {
    parse { 0 0 gs1lint } 3 1 roll
    2 index 1 3 -1 roll put
    1 index 0 3 -1 roll put
    true isEqual
} def

/er_tmpl {
    exch parse { 0 0 gs1lint } 3 1 roll
    2 index 1 3 -1 roll put
    1 index 0 3 -1 roll put
    exch isError
} def


% N18,csum,key
((00)123456789012345675) good_tmpl
((00)) /bwipp.GS1valueTooShort er_tmpl
((00)12345678901234567) /bwipp.GS1valueTooShort er_tmpl
((00)1234567890123456750) /bwipp.GS1valueTooLong er_tmpl
((00)123456789012345670) /bwipp.GS1badChecksum er_tmpl

% X..20
((10)) /bwipp.GS1valueTooShort er_tmpl
((10)1) good_tmpl
((10)12345678901234567890) good_tmpl
((10)123456789012345678901) /bwipp.GS1valueTooLong er_tmpl
((10)!"%&'*+,-/012345) good_tmpl
((10)6789:;<=>?ABCDEFGHIJ) good_tmpl
((10)KLMNOPQRSTUVWXYZ_abc) good_tmpl
((10)defghijklmnopqrstuvw) good_tmpl
((10)xyz) good_tmpl
((10) ) /bwipp.GS1badCSET82character er_tmpl

% X2 X..28
((7230)121234567890123456789012345678) good_tmpl
((7230)1212345678901234567890123456789) /bwipp.GS1valueTooLong er_tmpl
((7230)123) good_tmpl
((7230)12) /bwipp.GS1valueTooShort er_tmpl

% N1,zero N13,csum,key X0..16
((8003)01234567890128) good_tmpl
((8003)012345678901281) good_tmpl
((8003)012345678901281234567890123456) good_tmpl
((8003)0123456789012812345678901234567) /bwipp.GS1valueTooLong er_tmpl
((8003)112345678901281234567890123456) /bwipp.GS1zeroRequired er_tmpl

% N6,yymmd0
((11)000606) good_tmpl
((11)250606) good_tmpl
((11)500606) good_tmpl
((11)750606) good_tmpl
((11)990606) good_tmpl
((11)200131) good_tmpl
((11)200010) /bwipp.GS1badMonth er_tmpl
((11)201310) /bwipp.GS1badMonth er_tmpl
((11)200131) good_tmpl
((11)200132) /bwipp.GS1badDay er_tmpl
((11)200229) good_tmpl
((11)200230) /bwipp.GS1badDay er_tmpl
((11)200331) good_tmpl
((11)200332) /bwipp.GS1badDay er_tmpl
((11)200430) good_tmpl
((11)200431) /bwipp.GS1badDay er_tmpl
((11)200531) good_tmpl
((11)200532) /bwipp.GS1badDay er_tmpl
((11)200630) good_tmpl
((11)200631) /bwipp.GS1badDay er_tmpl
((11)200731) good_tmpl
((11)200732) /bwipp.GS1badDay er_tmpl
((11)200831) good_tmpl
((11)200832) /bwipp.GS1badDay er_tmpl
((11)200930) good_tmpl
((11)200931) /bwipp.GS1badDay er_tmpl
((11)201031) good_tmpl
((11)201032) /bwipp.GS1badDay er_tmpl
((11)201130) good_tmpl
((11)201131) /bwipp.GS1badDay er_tmpl
((11)201231) good_tmpl
((11)201232) /bwipp.GS1badDay er_tmpl
((11)210229) /bwipp.GS1badDay er_tmpl  % Not leap year
((11)200600) good_tmpl                 % D=00 permitted

% N6,yymmdd
((4326)200615) good_tmpl
((4326)200600) /bwipp.GS1badDay er_tmpl

% N2
((20)12) good_tmpl
((20)1A) /bwipp.GS1notNumeric er_tmpl

% N13,csum,key X0..17
((253)123456789012812345678901234567) good_tmpl
((253)1234567890128123456789012345678) /bwipp.GS1valueTooLong er_tmpl
((253)1234567890128) good_tmpl

% N3,isocc N..15
((3910)850123456789012345) good_tmpl
((3919)850123456789012345) good_tmpl
((3910)851123456789012345) /bwipp.GS1UnknownCountry er_tmpl
((3910)8501234567890123456) /bwipp.GS1valueTooLong er_tmpl
((3910)850) /bwipp.GS1valueTooShort er_tmpl

% N..15,isocclist
((423)850) good_tmpl
((423)004100400850894) good_tmpl
((423)8501) /bwipp.GS1BadCountryListLength er_tmpl

% X..30,key
((401)12) good_tmpl
((401)1) /bwipp.GS1keyTooShort er_tmpl
((401)) /bwipp.GS1valueTooShort er_tmpl
((401)A1) /bwipp.GS1badGCP er_tmpl
((401)1A) /bwipp.GS1badGCP er_tmpl

% X..35,pcenc
((4300)ABC) good_tmpl
((4300)ABC%20XYZ) good_tmpl
((4300)ABC%00XYZ) good_tmpl
((4300)ABC%FFXYZ) good_tmpl
((4300)ABC%ffXYZ) good_tmpl
((4300)ABC%fgXYZ) /bwipp.GS1badPercentChars er_tmpl
((4300)ABC%gfXYZ) /bwipp.GS1badPercentChars er_tmpl
((4300)ABC%g) /bwipp.GS1badPercentEscape er_tmpl
((4300)ABCDEFGHIJKLMNOPQRSTUVWXYZ%00+12345) good_tmpl
((4300)ABCDEFGHIJKLMNOPQRSTUVWXYZ%00+123456) /bwipp.GS1valueTooLong er_tmpl
((4301)ABCDEFGHIJKLMNOPQRSTUVWXYZ%00+12345) good_tmpl
((4301)ABCDEFGHIJKLMNOPQRSTUVWXYZ%00+123456) /bwipp.GS1valueTooLong er_tmpl
((4310)ABCDEFGHIJKLMNOPQRSTUVWXYZ%00+12345) good_tmpl
((4310)ABCDEFGHIJKLMNOPQRSTUVWXYZ%00+123456) /bwipp.GS1valueTooLong er_tmpl
((4311)ABCDEFGHIJKLMNOPQRSTUVWXYZ%00+12345) good_tmpl
((4311)ABCDEFGHIJKLMNOPQRSTUVWXYZ%00+123456) /bwipp.GS1valueTooLong er_tmpl
((4320)ABCDEFGHIJKLMNOPQRSTUVWXYZ%00+12345) good_tmpl
((4320)ABCDEFGHIJKLMNOPQRSTUVWXYZ%00+123456) /bwipp.GS1valueTooLong er_tmpl

% X..70,pcenc
((4302)A) good_tmpl
((4302)) /bwipp.GS1valueTooShort er_tmpl
((4302)ABCDEFGHIJKLMNOPQRSTUVWXYZ%00+1234567890123456789012345678901234567890) good_tmpl
((4302)ABCDEFGHIJKLMNOPQRSTUVWXYZ%00+12345678901234567890123456789012345678901) /bwipp.GS1valueTooLong er_tmpl
((4302)ABCDEFGHIJKLMNOPQRSTUVWXYZ%00+1234567890123456789012345678901234567%FG) /bwipp.GS1badPercentChars er_tmpl
((4302)ABCDEFGHIJKLMNOPQRSTUVWXYZ%00+123456789012345678901234567890123456789%) /bwipp.GS1badPercentEscape er_tmpl
((4303)ABCDEFGHIJKLMNOPQRSTUVWXYZ%00+1234567890123456789012345678901234567890) good_tmpl
((4303)ABCDEFGHIJKLMNOPQRSTUVWXYZ%00+12345678901234567890123456789012345678901) /bwipp.GS1valueTooLong er_tmpl
((4304)ABCDEFGHIJKLMNOPQRSTUVWXYZ%00+1234567890123456789012345678901234567890) good_tmpl
((4304)ABCDEFGHIJKLMNOPQRSTUVWXYZ%00+12345678901234567890123456789012345678901) /bwipp.GS1valueTooLong er_tmpl
((4305)ABCDEFGHIJKLMNOPQRSTUVWXYZ%00+1234567890123456789012345678901234567890) good_tmpl
((4305)ABCDEFGHIJKLMNOPQRSTUVWXYZ%00+12345678901234567890123456789012345678901) /bwipp.GS1valueTooLong er_tmpl
((4306)ABCDEFGHIJKLMNOPQRSTUVWXYZ%00+1234567890123456789012345678901234567890) good_tmpl
((4306)ABCDEFGHIJKLMNOPQRSTUVWXYZ%00+12345678901234567890123456789012345678901) /bwipp.GS1valueTooLong er_tmpl
((4312)ABCDEFGHIJKLMNOPQRSTUVWXYZ%00+1234567890123456789012345678901234567890) good_tmpl
((4312)ABCDEFGHIJKLMNOPQRSTUVWXYZ%00+12345678901234567890123456789012345678901) /bwipp.GS1valueTooLong er_tmpl
((4313)ABCDEFGHIJKLMNOPQRSTUVWXYZ%00+1234567890123456789012345678901234567890) good_tmpl
((4313)ABCDEFGHIJKLMNOPQRSTUVWXYZ%00+12345678901234567890123456789012345678901) /bwipp.GS1valueTooLong er_tmpl
((4314)ABCDEFGHIJKLMNOPQRSTUVWXYZ%00+1234567890123456789012345678901234567890) good_tmpl
((4314)ABCDEFGHIJKLMNOPQRSTUVWXYZ%00+12345678901234567890123456789012345678901) /bwipp.GS1valueTooLong er_tmpl
((4315)ABCDEFGHIJKLMNOPQRSTUVWXYZ%00+1234567890123456789012345678901234567890) good_tmpl
((4315)ABCDEFGHIJKLMNOPQRSTUVWXYZ%00+12345678901234567890123456789012345678901) /bwipp.GS1valueTooLong er_tmpl
((4316)ABCDEFGHIJKLMNOPQRSTUVWXYZ%00+1234567890123456789012345678901234567890) good_tmpl
((4316)ABCDEFGHIJKLMNOPQRSTUVWXYZ%00+12345678901234567890123456789012345678901) /bwipp.GS1valueTooLong er_tmpl

% N1,yesno
((4321)0) good_tmpl
((4321)1) good_tmpl
((4321)2) /bwipp.GS1badBoolean er_tmpl

% N6,yymmd0 N4,hhmm
((4324)2006150015) good_tmpl
((4324)2006152359) good_tmpl
((4324)2006152400) /bwipp.GS1badHour er_tmpl
((4324)2006151260) /bwipp.GS1badMinute er_tmpl

% N6,yymmdd N0..6,yymmdd
((7007)200615) good_tmpl
((7007)200615200615) good_tmpl
((7007)2006151) /bwipp.GS1badDateLength er_tmpl
((7007)20061512) /bwipp.GS1badDateLength er_tmpl
((7007)200615123) /bwipp.GS1badDateLength er_tmpl
((7007)2006151234) /bwipp.GS1badDateLength er_tmpl
((7007)20061512345) /bwipp.GS1badDateLength er_tmpl

% N1 X1 X1 X1,importeridx
((7040)1ABC) good_tmpl
((7040)1AB) /bwipp.GS1valueTooShort er_tmpl
((7040)1ABCD) /bwipp.GS1valueTooLong er_tmpl
((7040)1ABC) good_tmpl
((7040)1AB/) /bwipp.GS1badImporterIndex er_tmpl

% N4,nonzero N5,nonzero N3,nonzero N1,winding N1
((8001)00010000100109) good_tmpl
((8001)99999999999999) good_tmpl
((8001)00000000100109) /bwipp.GS1zeroNotPermitted er_tmpl
((8001)00010000000109) /bwipp.GS1zeroNotPermitted er_tmpl
((8001)00010000100119) good_tmpl
((8001)00010000100129) /bwipp.GS1badWinding er_tmpl
((8001)00010000100199) good_tmpl

% N14,csum N4,pieceoftotal
((8006)123456789012310203) good_tmpl
((8006)123456789012310303) good_tmpl
((8006)123456789012310003) /bwipp.GS1badPieceNumber er_tmpl
((8006)123456789012310200) /bwipp.GS1badPieceTotal er_tmpl
((8006)123456789012310302) /bwipp.GS1pieceExceedsTotal er_tmpl

% X..34,iban
((8007)BE71096123456769) good_tmpl
((8007)BE71096123456760) /bwipp.GS1badIBANchecksum er_tmpl
((8007)LC14BOSL123456789012345678901234) good_tmpl
((8007)LC14BOSL123456789012345678901230) /bwipp.GS1badIBANchecksum er_tmpl
((8007)LC14BOSLxx3456789012345678901230) /bwipp.GS1badIBANcharacter er_tmpl

% N6,yymmdd N..6,hhoptmmss
((8008)200615121530) good_tmpl
((8008)2006151215) good_tmpl
((8008)20061512) good_tmpl
((8008)200615241530) /bwipp.GS1badHour er_tmpl
((8008)200615126030) /bwipp.GS1badMinute er_tmpl
((8008)200615125960) /bwipp.GS1badSecond er_tmpl
((8008)2006151) /bwipp.GS1badTimeLength er_tmpl
((8008)200615123) /bwipp.GS1badTimeLength er_tmpl
((8008)20061512345) /bwipp.GS1badTimeLength er_tmpl

% C..30,key
((8010)12345ABC) good_tmpl
((8010)12#-/0123456789ABCDEFGHIJK) good_tmpl
((8010)12CDEFGHIJKLMNOPQRSTUVWXYZ) good_tmpl
((8010)12345AB_) /bwipp.GS1badCSET39character er_tmpl

% N..12,nozeroprefix
((8011)12345) good_tmpl
((8011)0) good_tmpl
((8011)01) /bwipp.GS1badZeroPrefix er_tmpl

% TODO X..70,couponcode

% TODO X..70,couponposoffer

% Unknown
((03)ABC) /bwipp.GS1unknownAI er_tmpl

% Compound
((01)95012345678903(3103)000123) good_tmpl
