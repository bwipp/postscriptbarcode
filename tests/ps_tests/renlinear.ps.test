% Barcode Writer in Pure PostScript
% https://bwipp.terryburton.co.uk
%
% vim: set sw=4 sts=4 et:
%
% Copyright (c) 2004-2026 Terry Burton
%

/renlinear dup /uk.co.terryburton.bwipp findresource cvx def

%
% Single bar: width 1
%
{
    0 0 moveto
    <<
        /ren /renlinear
        /sbs [1]
        /bhs [1]
        /bbs [0]
        /inkspread 0
        /opt << /debugbars true >>
    >> renlinear
} [
    72 0.5 0 1
] debugIsEqual

%
% Two bars: width 1, space 1, width 1
%
{
    0 0 moveto
    <<
        /ren /renlinear
        /sbs [1 1 1]
        /bhs [1 1]
        /bbs [0 0]
        /inkspread 0
        /opt << /debugbars true >>
    >> renlinear
} [
    72 0.5 0 1
    72 2.5 0 1
] debugIsEqual

%
% Three bars: width 2, space 1, width 1, space 1, width 3
%
{
    0 0 moveto
    <<
        /ren /renlinear
        /sbs [2 1 1 1 3]
        /bhs [1 1 1]
        /bbs [0 0 0]
        /inkspread 0
        /opt << /debugbars true >>
    >> renlinear
} [
    72 1 0 2
    72 3.5 0 1
    72 6.5 0 3
] debugIsEqual

%
% Bars with varying heights
%
{
    0 0 moveto
    <<
        /ren /renlinear
        /sbs [1 1 1 1 1]
        /bhs [1 0.5 2]
        /bbs [0 0 0]
        /inkspread 0
        /opt << /debugbars true >>
    >> renlinear
} [
    72 0.5 0 1
    36 2.5 0 1
    144 4.5 0 1
] debugIsEqual

%
% Bars with varying baselines
%
{
    0 0 moveto
    <<
        /ren /renlinear
        /sbs [1 1 1 1 1]
        /bhs [1 1 1]
        /bbs [0 0.5 1]
        /inkspread 0
        /opt << /debugbars true >>
    >> renlinear
} [
    72 0.5 0 1
    72 2.5 36 1
    72 4.5 72 1
] debugIsEqual

%
% Zero-width bar
%
{
    0 0 moveto
    <<
        /ren /renlinear
        /sbs [1 1 0 1 1]
        /bhs [1 1 1]
        /bbs [0 0 0]
        /inkspread 0
        /opt << /debugbars true >>
    >> renlinear
} [
    72 0.5 0 1
    72 3.5 0 1
] debugIsEqual

%
% Wide bars with wide spaces
%
{
    0 0 moveto
    <<
        /ren /renlinear
        /sbs [3 2 3 2 3]
        /bhs [1 1 1]
        /bbs [0 0 0]
        /inkspread 0
        /opt << /debugbars true >>
    >> renlinear
} [
    72 1.5 0 3
    72 6.5 0 3
    72 11.5 0 3
] debugIsEqual

%
% Bar ratio
%
{
    0 0 moveto
    <<
        /ren /renlinear
        /sbs [2 1 2]
        /bhs [1 1]
        /bbs [0 0]
        /inkspread 0
        /barratio 2
        /opt << /debugbars true >>
    >> renlinear
} [
    72 1.5 0 3
    72 5.5 0 3
] debugIsEqual

%
% Space ratios
%
{
    0 0 moveto
    <<
        /ren /renlinear
        /sbs [1 2 1]
        /bhs [1 1]
        /bbs [0 0]
        /inkspread 0
        /spaceratio 2
        /opt << /debugbars true >>
    >> renlinear
} [
    72 0.5 0 1
    72 4.5 0 1
] debugIsEqual

%
% DataBar Omnidirectional
%
{
    0 0 moveto
    <<
        /ren /renlinear
        /sbs [1 5 1 1 1 5 1 1 1 2 3 8 1 1 4 3 1 1 1 1 2 2 3 4 1 1 2 2 1 1 1 1 4 7 2 5 1 2 1 2 1 1 3 1 1]
        /bhs [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
        /bbs [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
        /inkspread 0
        /opt << /debugbars true >>
    >> renlinear
} [
    36 0.5 0 1    36 6.5 0 1    36 8.5 0 1    36 14.5 0 1   36 16.5 0 1   36 20.5 0 3
    36 30.5 0 1   36 34 0 4     36 39.5 0 1   36 41.5 0 1   36 44 0 2     36 48.5 0 3
    36 54.5 0 1   36 57 0 2     36 60.5 0 1   36 62.5 0 1   36 66 0 4     36 76 0 2
    36 82.5 0 1   36 85.5 0 1   36 88.5 0 1   36 91.5 0 3   36 94.5 0 1
] debugIsEqual


%
% Error tests
%

{
    0 0 moveto
    <<
        /ren /renlinear
        /sbs [1]
        /bhs [1]
        /bbs [0]
        /opt << /textxalign /invalid >>
    >> renlinear
} /bwipp.renlinearBadTextxalign isError

{
    0 0 moveto
    <<
        /ren /renlinear
        /sbs [1]
        /bhs [1]
        /bbs [0]
        /opt << /textyalign /invalid >>
    >> renlinear
} /bwipp.renlinearBadTextyalign isError

{
    0 0 moveto
    <<
        /ren /renlinear
        /sbs [1]
        /bhs [1]
        /bbs [0]
        /opt << /textdirection /invalid >>
    >> renlinear
} /bwipp.renlinearBadTextdirection isError

{
    0 0 moveto
    <<
        /ren /renlinear
        /sbs [1]
        /bhs [1]
        /bbs [0]
        /opt << /textsize 0 >>
    >> renlinear
} /bwipp.renlinearBadTextsize isError

{
    0 0 moveto
    <<
        /ren /renlinear
        /sbs [1]
        /bhs [1]
        /bbs [0]
        /opt << /textsize 30 >>
    >> renlinear
} /bwipp.renlinearBadTextsize isError

{
    0 0 moveto
    <<
        /ren /renlinear
        /sbs [1]
        /bhs [1]
        /bbs [0]
        /opt << /extratextxalign /invalid >>
    >> renlinear
} /bwipp.renlinearBadExtratextxalign isError

{
    0 0 moveto
    <<
        /ren /renlinear
        /sbs [1]
        /bhs [1]
        /bbs [0]
        /opt << /extratextyalign /invalid >>
    >> renlinear
} /bwipp.renlinearBadExtratextyalign isError

{
    0 0 moveto
    <<
        /ren /renlinear
        /sbs [1]
        /bhs [1]
        /bbs [0]
        /opt << /extratextdirection /invalid >>
    >> renlinear
} /bwipp.renlinearBadExtratextdirection isError

