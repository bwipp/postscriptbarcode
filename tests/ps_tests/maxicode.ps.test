% Barcode Writer in Pure PostScript
% https://bwipp.terryburton.co.uk
%
% Copyright (c) 2004-2024 Terry Burton

% ISO/IEC 16023:2000

% vim: set ts=4 sw=4 et :

/maxicode dup /uk.co.terryburton.bwipp findresource cvx def

/eq_tmpl {
    3 1 roll { 0 0 maxicode /p 990 array def 0 1 989 { p exch 0 put } for /pixs get { p exch 1 put } forall p }  % Convert to 0/1 array
    dup 3 -1 roll 1 exch put
    dup 3 -1 roll 0 exch put
    isEqual
} def


% Zero-pad US postcodes that lack "+4" (Annex B.1.4a)
/uszeropad  % Expected codewords
[  2 24 34 20 17 18  2 18  7  0 59 58 31 60 34  8 11 47 20 54 59 42 41 63 40 30 63 48 49 29 57 54 49 26 48 48
  48 48 52 57 53 49 29 21 16 19 14 29 48 54 24 54 49 48 29 49 53 57 29 49 50 51 52 53 54 55 29 49 47 49 29 29
  25 29 54 51 52 32  1 12 16  8  1 32  4 18 29 16  9 20 20 19  2 21 18  7  8 29 16  1 30 62  4 33 24 56  8 32
  30  3 27 35 41 33  1 21 56 27 50 29  7 61 12 13 34 45  3 37 47 17 29  1 45 17 59 11 29  9  7 24 43  7 18 30
] def

{  % With zeroing on input
    ([\)>^03001^02996152380000^029840^029001^0291Z00004951^029UPSN^02906X610^029159^0291234567^0291/1^029^029Y^029634 ALPHA DR^029PITTSBURGH^029PA^030^004)
    (mode=2 parse debugcws) maxicode
} uszeropad debugIsEqual

{  % Without
    ([\)>^03001^0299615238^029840^029001^0291Z00004951^029UPSN^02906X610^029159^0291234567^0291/1^029^029Y^029634 ALPHA DR^029PITTSBURGH^029PA^030^004)
    (mode=2 parse debugcws) maxicode
} uszeropad debugIsEqual


    % props to gitlost:
{   % A pure A/B example that could be one codeword less (should SHB instead of LCHB then SHA):
    (b..A)
    (mode=4 parse debugcws) maxicode
} [4 59 2 46 46 1 33 33 33 33 17 28 48 20 45 62 22 14 12 49 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 60 60 40 40 9 9 43 43 14 14 50 50 12 12 53 53 57 57 58 58 36 36 28 28 10 10 53 53 37 37 30 30 14 14 5 5 31 31 40 40] debugIsEqual

{   % Here's an A/B (and NS) example which could be one codeword less (immediate LCHB on "b" between NS segments instead of SHB and then LCHB after 2nd NS):
    % (props to gitlost for this one)
    (A123456789b123456789bbbA)
    (mode=4 parse debugcws) maxicode
} [ 4  1 31  7 22 60 52 21 63  2 16 27 40 34 32 50 55 12 11 42 31  7 22 60 52 21  2  2  2 59  1 33
   33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33
   33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33
   33 33 33 33 33 33 33 33 55 37 56 59 53 19 57 43 17 15  9 22 13 34  3 59 10 35 23 51 54 24 13 17
   20 55 43 59 24 35 6 17 50 57 36 35 11 20 19 52] debugIsEqual

{ % Don't stay in mode A when mode D or even C would be more efficient.
    (^192^224^224^224^192^224^224^224^192^224^224^224^192^224^224^224^192^224^224^224^192)
    (mode=4 parse debugcws) maxicode
} [ 4 60  0 61 61  0  0  0 60  0 52 57 14 53 29 37  0 27 40  3  0  0  0 60  0  0  0  0 60  0  0  0
    0 60  0  0  0  0 60  0 58 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33
   33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33
   33 33 33 33 33 33 33 33 62 45  3 41 29 23 53 42 13 62 10 63 17 22 10 11  3 63  2 59 60  7 61 24
   50 36 22 37 46 62  7 16 54 20 61 21  4  1 18 58] debugIsEqual


% Figures

(THIS IS A 93 CHARACTER CODE SET A MESSAGE THAT FILLS A MODE 4, UNAPPENDED, MAXICODE SYMBOL...) (mode=4 dontdraw)  % Figure 2 (and L1), same
[
    0 1 1 1 1 1 0 1 0 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 1 0 0 1 1 1
    0 0 0 1 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 1 0 1 0 0 0 0 0 0 0
    0 0 1 0 1 1 0 0 1 1 0 0 1 0 0 1 1 0 1 1 0 0 1 0 0 1 0 0 1 0
    1 0 0 0 0 0 0 1 0 0 0 1 1 0 0 0 1 0 0 1 0 0 0 0 0 0 0 0 0 0
    0 0 1 0 1 1 0 0 0 0 0 0 1 0 1 0 0 0 0 0 1 0 1 0 1 1 0 0 1 1
    1 1 1 0 1 0 0 0 1 0 0 0 0 0 1 0 1 1 0 0 1 0 0 0 1 1 1 1 0 0
    1 0 0 0 0 0 0 0 0 1 1 0 0 0 0 0 1 0 0 1 0 0 0 0 0 0 0 0 0 0
    0 0 0 0 1 0 1 0 0 0 1 0 0 1 0 0 1 0 0 0 1 0 0 1 1 1 1 1 0 0
    1 1 1 0 1 1 1 0 0 0 0 0 0 0 1 0 0 0 0 0 0 1 1 0 0 0 0 0 0 0
    0 0 0 0 0 0 0 1 1 0 1 1 0 0 0 0 0 0 0 1 0 1 0 0 0 1 1 0 0 0
    1 0 1 1 1 1 0 0 0 0 0 1 0 1 0 1 1 0 0 0 1 1 0 0 0 0 0 0 1 1
    0 0 1 1 1 0 0 0 1 0 1 0 0 0 0 0 0 0 1 1 1 0 1 0 0 0 1 1 1 0
    0 0 0 1 1 1 1 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 1 0 1 1 0 0 0
    1 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 1 1 0 0 1 0 0 0
    1 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 1 1 0 0 0 0 0 1 0 0 0
    0 0 0 0 1 0 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 1 0
    1 1 1 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 1 1 0 1
    0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 1 0 0 1 0 0
    0 0 0 0 0 0 1 0 1 1 0 0 0 0 0 0 0 0 0 0 1 0 0 1 0 1 0 0 0 1
    1 0 1 0 1 0 0 0 1 0 0 0 0 0 0 0 0 0 1 0 0 1 1 1 0 0 1 1 0 0
    0 0 1 0 0 0 0 1 1 0 0 0 0 0 0 0 0 0 0 1 1 1 0 0 0 0 1 0 1 0
    0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 1 0 0 0 0 1 0 0 0 0 0
    1 0 1 0 1 1 0 0 1 0 1 0 1 0 0 0 0 1 0 0 0 1 0 1 0 1 0 0 0 1
    1 0 0 0 1 1 1 1 0 0 1 0 1 0 1 0 0 1 1 0 1 0 1 0 0 0 1 0 1 0
    0 1 1 0 1 0 0 0 0 0 0 0 0 0 0 1 0 1 0 1 1 0 1 0 0 1 1 1 1 1
    0 0 0 0 0 1 1 1 0 0 1 1 1 1 1 1 1 1 1 1 1 1 0 0 0 1 0 1 0 0
    0 0 1 1 1 0 1 0 0 1 1 1 0 0 0 1 0 1 0 1 1 0 0 0 0 1 1 1 0 0
    1 1 0 1 1 1 0 1 1 1 0 0 1 0 0 0 0 1 1 0 1 0 0 1 0 1 0 1 1 0
    0 0 0 0 0 1 0 1 1 0 1 1 1 0 1 0 1 0 0 1 0 1 1 1 0 0 1 1 0 0
    1 1 1 0 0 0 1 1 0 1 1 1 1 0 0 0 1 0 0 0 1 1 1 1 0 1 1 1 1 0
    1 0 1 1 1 1 0 1 0 1 1 1 1 1 1 0 0 0 0 1 0 1 1 0 1 1 1 0 0 1
    0 0 1 0 0 1 1 0 1 1 1 1 1 0 1 1 0 1 1 0 1 0 1 0 0 1 1 1 0 0
    0 0 1 0 1 1 0 0 0 0 0 0 1 1 1 1 0 1 1 0 0 1 0 0 0 0 1 0 0 0
] eq_tmpl

([\)>^03001^02996152382802^029840^029001^0291Z00004951^029UPSN^02906X610^029159^0291234567^0291/1^029^029Y^029634 ALPHA DR^029PITTSBURGH^029PA^030^004) (mode=2 parse dontdraw)  % Figure B2, not same, different encodation
[
    1 1 0 1 0 1 1 1 0 1 1 0 1 1 1 1 1 1 1 0 1 1 1 1 1 1 1 0 1 1
    0 1 0 1 0 1 1 1 0 1 1 1 1 1 0 0 0 0 1 1 0 1 1 0 0 0 0 1 0 0
    1 1 0 1 1 0 1 1 0 0 0 1 1 1 0 0 1 0 1 0 1 0 0 1 1 0 0 1 1 1
    1 0 0 0 1 0 1 0 1 0 1 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0
    1 1 1 1 0 0 0 0 1 0 1 1 0 0 1 0 0 1 1 0 0 0 0 0 0 0 0 0 1 0
    1 0 0 1 1 1 0 0 1 0 1 0 1 0 1 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0
    1 1 1 1 1 0 1 1 1 1 1 1 1 0 1 1 1 1 1 1 1 0 1 1 1 1 1 1 1 0
    0 0 1 0 0 1 1 0 0 0 0 0 1 1 0 0 1 0 0 1 1 1 0 0 0 0 0 0 0 0
    0 0 0 1 0 0 0 1 1 0 0 0 1 0 1 0 1 0 1 0 1 0 1 0 0 1 1 1 1 0
    0 1 1 1 1 0 1 1 0 0 1 1 0 1 0 0 0 0 0 1 1 0 1 1 1 1 1 1 0 0
    1 1 0 0 1 1 1 0 0 0 1 1 1 1 0 0 0 0 0 0 1 1 1 0 1 0 1 0 0 0
    1 1 1 0 1 0 1 1 1 0 0 0 0 0 0 0 0 1 0 1 1 1 0 1 1 0 0 0 1 0
    1 1 1 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 1 1 0 1 0 1 1 1 1
    0 0 1 1 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0 1 1 0 0 1 1 1 1 0 0 0
    1 0 1 0 1 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 1 1 0 1 0 0 1 1 1
    1 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 1 1 1 0 1 1 1 1 1 0 0
    0 0 1 1 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 1 0 0 0 0 0
    0 0 0 0 1 0 1 0 1 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 1 1 1 0
    0 0 0 0 0 1 1 1 1 1 0 0 0 0 0 0 0 0 0 0 1 1 0 0 1 0 1 0 1 0
    0 1 0 0 0 0 1 0 1 1 0 0 0 0 0 0 0 0 0 0 1 0 1 0 0 0 1 1 0 0
    0 0 1 0 0 0 1 1 1 0 1 0 0 0 0 0 0 0 0 1 1 1 0 0 0 1 1 0 1 1
    1 0 0 0 1 0 1 0 0 0 0 0 0 0 0 0 0 0 1 1 0 1 1 0 0 0 1 0 0 0
    1 0 0 0 0 0 1 0 1 1 1 0 1 0 0 1 0 1 1 0 0 1 1 0 0 1 0 0 0 0
    1 0 0 1 1 1 0 0 0 0 1 0 1 0 1 0 0 1 1 0 0 0 0 0 1 0 0 0 1 0
    1 0 0 0 0 0 1 0 1 0 0 0 1 0 1 1 0 0 0 1 1 0 1 1 0 0 0 1 1 1
    0 0 1 0 0 1 1 1 0 0 0 0 1 1 1 1 1 0 0 0 0 1 0 1 0 1 0 0 0 0
    0 1 1 1 0 0 1 0 0 0 1 0 0 1 0 1 0 0 1 0 0 0 0 0 0 0 0 0 0 1
    1 1 0 0 1 0 1 1 1 0 1 1 1 0 0 0 0 1 0 1 0 1 1 0 0 0 1 0 0 0
    1 1 1 0 1 1 0 0 0 1 0 1 1 0 0 0 0 0 0 1 0 0 0 1 0 0 1 1 0 1
    1 0 1 1 1 0 0 1 1 1 0 0 1 0 1 0 1 0 1 0 1 1 1 1 1 1 0 1 0 0
    0 0 0 0 0 1 0 1 0 0 0 1 0 1 1 0 1 0 0 0 0 1 1 0 1 1 0 0 1 1
    1 1 1 1 0 0 1 1 0 0 1 0 1 1 0 0 1 1 0 0 1 1 0 0 0 1 0 1 1 0
    0 0 1 0 0 1 1 0 1 1 1 0 1 1 1 0 1 0 1 0 1 0 1 0 1 1 1 1 0 1
] eq_tmpl
